var THREE=THREE||{REVISION:"49"};if(!self.Int32Array){self.Int32Array=Array;self.Float32Array=Array}THREE.Color=function(a){a!==undefined&&this.setHex(a);return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(a){this.r=a.r;this.g=a.g;this.b=a.b;return this},setRGB:function(c,b,a){this.r=c;this.g=b;this.b=a;return this},setHex:function(a){a=Math.floor(a);this.r=(a>>16&255)/255;this.g=(a>>8&255)/255;this.b=(a&255)/255;return this},lerpSelf:function(b,a){this.r+=(b.r-this.r)*a;this.g+=(b.g-this.g)*a;this.b+=(b.b-this.b)*a;return this},getHex:function(){return Math.floor(this.r*255)<<16^Math.floor(this.g*255)<<8^Math.floor(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.Vector2=function(a,b){this.x=a||0;this.y=b||0};THREE.Vector2.prototype={constructor:THREE.Vector2};THREE.Vector3=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};THREE.Vector3.prototype={constructor:THREE.Vector3,"set":function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a;this.z/=a}else{this.x=0;this.y=0;this.z=0}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},cross:function(a,b){this.x=a.y*b.z-a.z*b.y;this.y=a.z*b.x-a.x*b.z;this.z=a.x*b.y-a.y*b.x;return this},distanceTo:function(a){return Math.sqrt(this.distanceToSquared(a))},distanceToSquared:function(a){return(new THREE.Vector3).sub(this,a).lengthSq()},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(b,c,d,a){this.x=b||0;this.y=c||0;this.z=d||0;this.w=a!==undefined?a:1};THREE.Vector4.prototype={constructor:THREE.Vector4,"set":function(b,c,d,a){this.x=b;this.y=c;this.z=d;this.w=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w!==undefined?a.w:1;return this},add:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addSelf:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this},sub:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},subSelf:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;this.w-=a.w;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;this.w*=a;return this},divideScalar:function(a){if(a){this.x/=a;this.y/=a;this.z/=a;this.w/=a}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())}};THREE.Frustum=function(){this.planes=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4]};THREE.Frustum.prototype.setFromMatrix=function(u){var h,b,c=this.planes,a=u.elements,m=a[0],n=a[1],o=a[2],f=a[3],p=a[4],q=a[5],r=a[6],g=a[7],s=a[8],t=a[9],i=a[10],d=a[11],j=a[12],k=a[13],l=a[14],e=a[15];c[0].set(f-m,g-p,d-s,e-j);c[1].set(f+m,g+p,d+s,e+j);c[2].set(f+n,g+q,d+t,e+k);c[3].set(f-n,g-q,d-t,e-k);c[4].set(f-o,g-r,d-i,e-l);c[5].set(f+o,g+r,d+i,e+l);for(h=0;h<6;h++){b=c[h];b.divideScalar(Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z))}};THREE.Frustum.prototype.contains=function(f){for(var d,b=this.planes,e=f.matrixWorld,c=e.elements,g=-f.geometry.boundingSphere.radius*e.getMaxScaleOnAxis(),a=0;a<6;a++){d=b[a].x*c[12]+b[a].y*c[13]+b[a].z*c[14]+b[a].w;if(d<=g)return false}return true};THREE.Frustum.__v1=new THREE.Vector3;THREE.Rectangle=function(){var a,b,d,c,h,g,f=true;function e(){h=d-a;g=c-b}this.getX=function(){return a};this.getY=function(){return b};this.getWidth=function(){return h};this.getHeight=function(){return g};this.getLeft=function(){return a};this.getTop=function(){return b};this.getRight=function(){return d};this.getBottom=function(){return c};this.set=function(i,j,h,g){f=false;a=i;b=j;d=h;c=g;e()};this.addPoint=function(g,h){if(f){f=false;a=g;b=h;d=g;c=h;e()}else{a=a<g?a:g;b=b<h?b:h;d=d>g?d:g;c=c>h?c:h;e()}};this.addRectangle=function(g){if(f){f=false;a=g.getLeft();b=g.getTop();d=g.getRight();c=g.getBottom();e()}else{a=a<g.getLeft()?a:g.getLeft();b=b<g.getTop()?b:g.getTop();d=d>g.getRight()?d:g.getRight();c=c>g.getBottom()?c:g.getBottom();e()}};this.inflate=function(f){a-=f;b-=f;d+=f;c+=f;e()};this.minSelf=function(f){a=a>f.getLeft()?a:f.getLeft();b=b>f.getTop()?b:f.getTop();d=d<f.getRight()?d:f.getRight();c=c<f.getBottom()?c:f.getBottom();e()};this.intersects=function(e){return d<e.getLeft()?false:a>e.getRight()?false:c<e.getTop()?false:b>e.getBottom()?false:true};this.empty=function(){f=true;a=0;b=0;d=0;c=0;e()};this.isEmpty=function(){return f}};THREE.Matrix3=function(){this.elements=new Float32Array(9)};THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(h){var a=h.elements,d=a[10]*a[5]-a[6]*a[9],i=-a[10]*a[1]+a[2]*a[9],l=a[6]*a[1]-a[2]*a[5],e=-a[10]*a[4]+a[6]*a[8],j=a[10]*a[0]-a[2]*a[8],m=-a[6]*a[0]+a[2]*a[4],f=a[9]*a[4]-a[5]*a[8],k=-a[9]*a[0]+a[1]*a[8],n=a[5]*a[0]-a[1]*a[4],g=a[0]*d+a[1]*e+a[2]*f;g===0&&console.warn("Matrix3.getInverse(): determinant == 0");var b=1/g,c=this.elements;c[0]=b*d;c[1]=b*i;c[2]=b*l;c[3]=b*e;c[4]=b*j;c[5]=b*m;c[6]=b*f;c[7]=b*k;c[8]=b*n;return this}};THREE.Matrix4=function(a,e,f,g,h,b,i,j,k,l,c,m,n,o,p,d){this.elements=new Float32Array(16);this.set(a!==undefined?a:1,e||0,f||0,g||0,h||0,b!==undefined?b:1,i||0,j||0,k||0,l||0,c!==undefined?c:1,m||0,n||0,o||0,p||0,d!==undefined?d:1)};THREE.Matrix4.prototype={constructor:THREE.Matrix4,"set":function(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var a=this.elements;a[0]=b;a[4]=c;a[8]=d;a[12]=e;a[1]=f;a[5]=g;a[9]=h;a[13]=i;a[2]=j;a[6]=k;a[10]=l;a[14]=m;a[3]=n;a[7]=o;a[11]=p;a[15]=q;return this},copy:function(b){var a=b.elements;this.set(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]);return this},lookAt:function(g,f,e){var b=this.elements,c=THREE.Matrix4.__v1,d=THREE.Matrix4.__v2,a=THREE.Matrix4.__v3;a.sub(g,f).normalize();if(a.length()===0)a.z=1;c.cross(e,a).normalize();if(c.length()===0){a.x+=1e-4;c.cross(e,a).normalize()}d.cross(a,c);b[0]=c.x;b[4]=d.x;b[8]=a.x;b[1]=c.y;b[5]=d.y;b[9]=a.y;b[2]=c.z;b[6]=d.z;b[10]=a.z;return this},multiply:function(J,K){var a=J.elements,b=K.elements,c=this.elements,d=a[0],e=a[4],f=a[8],g=a[12],h=a[1],i=a[5],j=a[9],k=a[13],l=a[2],m=a[6],n=a[10],o=a[14],p=a[3],q=a[7],r=a[11],s=a[15],t=b[0],u=b[4],v=b[8],w=b[12],x=b[1],y=b[5],z=b[9],A=b[13],B=b[2],C=b[6],D=b[10],E=b[14],F=b[3],G=b[7],H=b[11],I=b[15];c[0]=d*t+e*x+f*B+g*F;c[4]=d*u+e*y+f*C+g*G;c[8]=d*v+e*z+f*D+g*H;c[12]=d*w+e*A+f*E+g*I;c[1]=h*t+i*x+j*B+k*F;c[5]=h*u+i*y+j*C+k*G;c[9]=h*v+i*z+j*D+k*H;c[13]=h*w+i*A+j*E+k*I;c[2]=l*t+m*x+n*B+o*F;c[6]=l*u+m*y+n*C+o*G;c[10]=l*v+m*z+n*D+o*H;c[14]=l*w+m*A+n*E+o*I;c[3]=p*t+q*x+r*B+s*F;c[7]=p*u+q*y+r*C+s*G;c[11]=p*v+q*z+r*D+s*H;c[15]=p*w+q*A+r*E+s*I;return this},multiplyScalar:function(b){var a=this.elements;a[0]*=b;a[4]*=b;a[8]*=b;a[12]*=b;a[1]*=b;a[5]*=b;a[9]*=b;a[13]*=b;a[2]*=b;a[6]*=b;a[10]*=b;a[14]*=b;a[3]*=b;a[7]*=b;a[11]*=b;a[15]*=b;return this},multiplyVector3:function(b){var a=this.elements,c=b.x,d=b.y,e=b.z,f=1/(a[3]*c+a[7]*d+a[11]*e+a[15]);b.x=(a[0]*c+a[4]*d+a[8]*e+a[12])*f;b.y=(a[1]*c+a[5]*d+a[9]*e+a[13])*f;b.z=(a[2]*c+a[6]*d+a[10]*e+a[14])*f;return b},multiplyVector4:function(b){var a=this.elements,d=b.x,e=b.y,f=b.z,c=b.w;b.x=a[0]*d+a[4]*e+a[8]*f+a[12]*c;b.y=a[1]*d+a[5]*e+a[9]*f+a[13]*c;b.z=a[2]*d+a[6]*e+a[10]*f+a[14]*c;b.w=a[3]*d+a[7]*e+a[11]*f+a[15]*c;return b},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return e*h*k*n-d*i*k*n-e*g*l*n+c*i*l*n+d*g*m*n-c*h*m*n-e*h*j*o+d*i*j*o+e*f*l*o-b*i*l*o-d*f*m*o+b*h*m*o+e*g*j*p-c*i*j*p-e*f*k*p+b*i*k*p+c*f*m*p-b*g*m*p-d*g*j*q+c*h*j*q+d*f*k*q-b*h*k*q-c*f*l*q+b*g*l*q},getPosition:function(){var a=this.elements;return THREE.Matrix4.__v1.set(a[12],a[13],a[14])},setPosition:function(b){var a=this.elements;a[12]=b.x;a[13]=b.y;a[14]=b.z;return this},getInverse:function(s){var r=this.elements,q=s.elements,a=q[0],b=q[4],c=q[8],d=q[12],e=q[1],f=q[5],g=q[9],h=q[13],i=q[2],j=q[6],k=q[10],l=q[14],m=q[3],n=q[7],o=q[11],p=q[15];r[0]=g*l*n-h*k*n+h*j*o-f*l*o-g*j*p+f*k*p;r[4]=d*k*n-c*l*n-d*j*o+b*l*o+c*j*p-b*k*p;r[8]=c*h*n-d*g*n+d*f*o-b*h*o-c*f*p+b*g*p;r[12]=d*g*j-c*h*j-d*f*k+b*h*k+c*f*l-b*g*l;r[1]=h*k*m-g*l*m-h*i*o+e*l*o+g*i*p-e*k*p;r[5]=c*l*m-d*k*m+d*i*o-a*l*o-c*i*p+a*k*p;r[9]=d*g*m-c*h*m-d*e*o+a*h*o+c*e*p-a*g*p;r[13]=c*h*i-d*g*i+d*e*k-a*h*k-c*e*l+a*g*l;r[2]=f*l*m-h*j*m+h*i*n-e*l*n-f*i*p+e*j*p;r[6]=d*j*m-b*l*m-d*i*n+a*l*n+b*i*p-a*j*p;r[10]=b*h*m-d*f*m+d*e*n-a*h*n-b*e*p+a*f*p;r[14]=d*f*i-b*h*i-d*e*j+a*h*j+b*e*l-a*f*l;r[3]=g*j*m-f*k*m-g*i*n+e*k*n+f*i*o-e*j*o;r[7]=b*k*m-c*j*m+c*i*n-a*k*n-b*i*o+a*j*o;r[11]=c*f*m-b*g*m-c*e*n+a*g*n+b*e*o-a*f*o;r[15]=b*g*i-c*f*i+c*e*j-a*g*j-b*e*k+a*f*k;this.multiplyScalar(1/s.determinant());return this},setRotationFromEuler:function(t,x){var a=this.elements,u=t.x,v=t.y,w=t.z,e=Math.cos(u),b=Math.sin(u),f=Math.cos(v),c=Math.sin(v),g=Math.cos(w),d=Math.sin(w);switch(x){case"YXZ":var p=f*g,q=f*d,r=c*g,s=c*d;a[0]=p+s*b;a[4]=r*b-q;a[8]=e*c;a[1]=e*d;a[5]=e*g;a[9]=-b;a[2]=q*b-r;a[6]=s+p*b;a[10]=e*f;break;case"ZXY":var p=f*g,q=f*d,r=c*g,s=c*d;a[0]=p-s*b;a[4]=-e*d;a[8]=r+q*b;a[1]=q+r*b;a[5]=e*g;a[9]=s-p*b;a[2]=-e*c;a[6]=b;a[10]=e*f;break;case"ZYX":var j=e*g,k=e*d,n=b*g,o=b*d;a[0]=f*g;a[4]=n*c-k;a[8]=j*c+o;a[1]=f*d;a[5]=o*c+j;a[9]=k*c-n;a[2]=-c;a[6]=b*f;a[10]=e*f;break;case"YZX":var h=e*f,i=e*c,l=b*f,m=b*c;a[0]=f*g;a[4]=m-h*d;a[8]=l*d+i;a[1]=d;a[5]=e*g;a[9]=-b*g;a[2]=-c*g;a[6]=i*d+l;a[10]=h-m*d;break;case"XZY":var h=e*f,i=e*c,l=b*f,m=b*c;a[0]=f*g;a[4]=-d;a[8]=c*g;a[1]=h*d+m;a[5]=e*g;a[9]=i*d-l;a[2]=l*d-i;a[6]=b*g;a[10]=m*d+h;break;default:var j=e*g,k=e*d,n=b*g,o=b*d;a[0]=f*g;a[4]=-f*d;a[8]=c;a[1]=k+n*c;a[5]=j-o*c;a[9]=-b*f;a[2]=o-j*c;a[6]=n+k*c;a[10]=e*f}return this},setRotationFromQuaternion:function(d){var a=this.elements,b=d.x,e=d.y,h=d.z,g=d.w,l=b+b,f=e+e,c=h+h,m=b*l,n=b*f,o=b*c,p=e*f,q=e*c,r=h*c,i=g*l,j=g*f,k=g*c;a[0]=1-(p+r);a[4]=n-k;a[8]=o+j;a[1]=n+k;a[5]=1-(m+r);a[9]=q-i;a[2]=o-j;a[6]=q+i;a[10]=1-(m+p);return this},extractRotation:function(g){var b=this.elements,a=g.elements,f=THREE.Matrix4.__v1,c=1/f.set(a[0],a[1],a[2]).length(),d=1/f.set(a[4],a[5],a[6]).length(),e=1/f.set(a[8],a[9],a[10]).length();b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c;b[4]=a[4]*d;b[5]=a[5]*d;b[6]=a[6]*d;b[8]=a[8]*e;b[9]=a[9]*e;b[10]=a[10]*e;return this},translate:function(e){var a=this.elements,b=e.x,c=e.y,d=e.z;a[12]=a[0]*b+a[4]*c+a[8]*d+a[12];a[13]=a[1]*b+a[5]*c+a[9]*d+a[13];a[14]=a[2]*b+a[6]*c+a[10]*d+a[14];a[15]=a[3]*b+a[7]*c+a[11]*d+a[15];return this},rotateX:function(d){var a=this.elements,e=a[4],g=a[5],i=a[6],k=a[7],f=a[8],h=a[9],j=a[10],l=a[11],b=Math.cos(d),c=Math.sin(d);a[4]=b*e+c*f;a[5]=b*g+c*h;a[6]=b*i+c*j;a[7]=b*k+c*l;a[8]=b*f-c*e;a[9]=b*h-c*g;a[10]=b*j-c*i;a[11]=b*l-c*k;return this},rotateY:function(d){var a=this.elements,e=a[0],g=a[1],i=a[2],k=a[3],f=a[8],h=a[9],j=a[10],l=a[11],b=Math.cos(d),c=Math.sin(d);a[0]=b*e-c*f;a[1]=b*g-c*h;a[2]=b*i-c*j;a[3]=b*k-c*l;a[8]=b*f+c*e;a[9]=b*h+c*g;a[10]=b*j+c*i;a[11]=b*l+c*k;return this},rotateZ:function(d){var a=this.elements,e=a[0],g=a[1],i=a[2],k=a[3],f=a[4],h=a[5],j=a[6],l=a[7],b=Math.cos(d),c=Math.sin(d);a[0]=b*e+c*f;a[1]=b*g+c*h;a[2]=b*i+c*j;a[3]=b*k+c*l;a[4]=b*f-c*e;a[5]=b*h-c*g;a[6]=b*j-c*i;a[7]=b*l-c*k;return this},rotateByAxis:function(b,f){var a=this.elements;if(b.x===1&&b.y===0&&b.z===0)return this.rotateX(f);else if(b.x===0&&b.y===1&&b.z===0)return this.rotateY(f);else if(b.x===0&&b.y===0&&b.z===1)return this.rotateZ(f);var c=b.x,d=b.y,e=b.z,D=Math.sqrt(c*c+d*d+e*e);c/=D;d/=D;e/=D;var G=c*c,K=d*d,N=e*e,p=Math.cos(f),E=Math.sin(f),q=1-p,H=c*d*q,I=c*e*q,L=d*e*q,F=c*E,J=d*E,M=e*E,g=G+(1-G)*p,j=H+M,m=I-J,h=H-M,k=K+(1-K)*p,n=L+F,i=I+J,l=L-F,o=N+(1-N)*p,r=a[0],u=a[1],x=a[2],A=a[3],s=a[4],v=a[5],y=a[6],B=a[7],t=a[8],w=a[9],z=a[10],C=a[11],O=a[12],P=a[13],Q=a[14],R=a[15];a[0]=g*r+j*s+m*t;a[1]=g*u+j*v+m*w;a[2]=g*x+j*y+m*z;a[3]=g*A+j*B+m*C;a[4]=h*r+k*s+n*t;a[5]=h*u+k*v+n*w;a[6]=h*x+k*y+n*z;a[7]=h*A+k*B+n*C;a[8]=i*r+l*s+o*t;a[9]=i*u+l*v+o*w;a[10]=i*x+l*y+o*z;a[11]=i*A+l*B+o*C;return this},scale:function(e){var a=this.elements,b=e.x,c=e.y,d=e.z;a[0]*=b;a[4]*=c;a[8]*=d;a[1]*=b;a[5]*=c;a[9]*=d;a[2]*=b;a[6]*=c;a[10]*=d;a[3]*=b;a[7]*=c;a[11]*=d;return this},getMaxScaleOnAxis:function(){var a=this.elements,b=a[0]*a[0]+a[1]*a[1]+a[2]*a[2],c=a[4]*a[4]+a[5]*a[5]+a[6]*a[6],d=a[8]*a[8]+a[9]*a[9]+a[10]*a[10];return Math.sqrt(Math.max(b,Math.max(c,d)))},makeFrustum:function(f,e,d,g,b,c){var a=this.elements,l=2*b/(e-f),m=2*b/(g-d),h=(e+f)/(e-f),i=(g+d)/(g-d),j=-(c+b)/(c-b),k=-2*c*b/(c-b);a[0]=l;a[4]=0;a[8]=h;a[12]=0;a[1]=0;a[5]=m;a[9]=i;a[13]=0;a[2]=0;a[6]=0;a[10]=j;a[14]=k;a[3]=0;a[7]=0;a[11]=-1;a[15]=0;return this},makePerspective:function(h,b,c,g){var a=c*Math.tan(h*Math.PI/360),d=-a,f=d*b,e=a*b;return this.makeFrustum(f,e,d,a,c,g)},clone:function(){var a=this.elements;return new THREE.Matrix4(a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15])}};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;THREE.Matrix4.__m1=new THREE.Matrix4;THREE.Matrix4.__m2=new THREE.Matrix4;THREE.Object3D=function(){this.id=THREE.Object3DCount++;this.name="";this.parent=undefined;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.doubleSided=false;this.flipSided=false;this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=true;this.useQuaternion=false;this.boundRadius=0;this.boundRadiusScale=1;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this._vector=new THREE.Vector3};THREE.Object3D.prototype={constructor:THREE.Object3D,add:function(a){if(a===this){console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");return}if(a instanceof THREE.Object3D){a.parent!==undefined&&a.parent.remove(a);a.parent=this;this.children.push(a);var b=this;while(b.parent!==undefined)b=b.parent;b!==undefined&&b instanceof THREE.Scene&&b.__addObject(a)}},remove:function(b){var c=this.children.indexOf(b);if(c!==-1){b.parent=undefined;this.children.splice(c,1);var a=this;while(a.parent!==undefined)a=a.parent;a!==undefined&&a instanceof THREE.Scene&&a.__removeObject(b)}},updateMatrix:function(){this.matrix.setPosition(this.position);if(this.useQuaternion)this.matrix.setRotationFromQuaternion(this.quaternion);else this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(a){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||a){if(this.parent)this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix);else this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;a=true}for(var b=0,c=this.children.length;b<c;b++)this.children[b].updateMatrixWorld(a)}};THREE.Object3DCount=0;THREE.Projector=function(){var j,f,m=[],c,g,d=[],a,h,n=[],i,o=[],E,v,B=[],C,u,A=[],b={objects:[],sprites:[],lights:[],elements:[]},k=new THREE.Vector3,D=new THREE.Vector4,e=new THREE.Matrix4,y=new THREE.Matrix4,p=new THREE.Frustum,w=new THREE.Vector4,x=new THREE.Vector4,z;this.projectGraph=function(c,d){f=0;b.objects.length=0;b.sprites.length=0;b.lights.length=0;var a=function(c){if(c.visible===false)return;if(c instanceof THREE.Mesh&&(c.frustumCulled===false||p.contains(c))){k.copy(c.matrixWorld.getPosition());e.multiplyVector3(k);j=q();j.object=c;j.z=k.z;b.objects.push(j)}else c instanceof THREE.Light&&b.lights.push(c);for(var d=0,f=c.children.length;d<f;d++)a(c.children[d])};a(c);d&&b.objects.sort(l);return b};this.projectScene=function(M,o,V){var U=o.near,W=o.far,w=false,F,R,G,T,y,P,z,Q,x,O,A,S,f,B,H,C,N,K,Y,X,L,j,I,D,J,E,k,m,n,q;h=0;i=0;v=0;u=0;b.elements.length=0;if(o.parent===undefined){console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it...");M.add(o)}M.updateMatrixWorld();o.matrixWorldInverse.getInverse(o.matrixWorld);e.multiply(o.projectionMatrix,o.matrixWorldInverse);p.setFromMatrix(e);b=this.projectGraph(M,false);for(F=0,R=b.objects.length;F<R;F++){f=b.objects[F].object;B=f.matrixWorld;g=0;if(f instanceof THREE.Mesh){C=f.geometry;N=f.geometry.materials;K=C.vertices;L=C.faces;J=C.faceVertexUvs;H=f.matrixRotationWorld.extractRotation(B);for(G=0,T=K.length;G<T;G++){c=r();c.positionWorld.copy(K[G]);B.multiplyVector3(c.positionWorld);c.positionScreen.copy(c.positionWorld);e.multiplyVector4(c.positionScreen);c.positionScreen.x/=c.positionScreen.w;c.positionScreen.y/=c.positionScreen.w;c.visible=c.positionScreen.z>U&&c.positionScreen.z<W}for(y=0,P=L.length;y<P;y++){j=L[y];if(j instanceof THREE.Face3){k=d[j.a];m=d[j.b];n=d[j.c];if(k.visible&&m.visible&&n.visible){w=(n.positionScreen.x-k.positionScreen.x)*(m.positionScreen.y-k.positionScreen.y)-(n.positionScreen.y-k.positionScreen.y)*(m.positionScreen.x-k.positionScreen.x)<0;if(f.doubleSided||w!=f.flipSided){a=s();a.v1.copy(k);a.v2.copy(m);a.v3.copy(n)}else continue}else continue}else if(j instanceof THREE.Face4){k=d[j.a];m=d[j.b];n=d[j.c];q=d[j.d];if(k.visible&&m.visible&&n.visible&&q.visible){w=(q.positionScreen.x-k.positionScreen.x)*(m.positionScreen.y-k.positionScreen.y)-(q.positionScreen.y-k.positionScreen.y)*(m.positionScreen.x-k.positionScreen.x)<0||(m.positionScreen.x-n.positionScreen.x)*(q.positionScreen.y-n.positionScreen.y)-(m.positionScreen.y-n.positionScreen.y)*(q.positionScreen.x-n.positionScreen.x)<0;if(f.doubleSided||w!=f.flipSided){a=t();a.v1.copy(k);a.v2.copy(m);a.v3.copy(n);a.v4.copy(q)}else continue}else continue}a.normalWorld.copy(j.normal);!w&&(f.flipSided||f.doubleSided)&&a.normalWorld.negate();H.multiplyVector3(a.normalWorld);a.centroidWorld.copy(j.centroid);B.multiplyVector3(a.centroidWorld);a.centroidScreen.copy(a.centroidWorld);e.multiplyVector3(a.centroidScreen);I=j.vertexNormals;for(z=0,Q=I.length;z<Q;z++){D=a.vertexNormalsWorld[z];D.copy(I[z]);!w&&(f.flipSided||f.doubleSided)&&D.negate();H.multiplyVector3(D)}for(x=0,O=J.length;x<O;x++){E=J[x][y];if(!E)continue;for(A=0,S=E.length;A<S;A++)a.uvs[x][A]=E[A]}a.material=f.material;a.faceMaterial=j.materialIndex!==null?N[j.materialIndex]:null;a.z=a.centroidScreen.z;b.elements.push(a)}}}V&&b.elements.sort(l);return b};function q(){var a=m[f]=m[f]||new THREE.RenderableObject;f++;return a}function r(){var a=d[g]=d[g]||new THREE.RenderableVertex;g++;return a}function s(){var a=n[h]=n[h]||new THREE.RenderableFace3;h++;return a}function t(){var a=o[i]=o[i]||new THREE.RenderableFace4;i++;return a}function l(a,b){return b.z-a.z}};THREE.Face3=function(d,e,f,a,b,c){this.a=d;this.b=e;this.c=f;this.normal=a instanceof THREE.Vector3?a:new THREE.Vector3;this.vertexNormals=a instanceof Array?a:[];this.color=b instanceof THREE.Color?b:new THREE.Color;this.vertexColors=b instanceof Array?b:[];this.vertexTangents=[];this.materialIndex=c;this.centroid=new THREE.Vector3};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var b=new THREE.Face3(this.a,this.b,this.c);b.normal.copy(this.normal);b.color.copy(this.color);b.centroid.copy(this.centroid);b.materialIndex=this.materialIndex;var a,c;for(a=0,c=this.vertexNormals.length;a<c;a++)b.vertexNormals[a]=this.vertexNormals[a].clone();for(a=0,c=this.vertexColors.length;a<c;a++)b.vertexColors[a]=this.vertexColors[a].clone();for(a=0,c=this.vertexTangents.length;a<c;a++)b.vertexTangents[a]=this.vertexTangents[a].clone();return b}};THREE.Face4=function(d,e,f,g,a,b,c){this.a=d;this.b=e;this.c=f;this.d=g;this.normal=a instanceof THREE.Vector3?a:new THREE.Vector3;this.vertexNormals=a instanceof Array?a:[];this.color=b instanceof THREE.Color?b:new THREE.Color;this.vertexColors=b instanceof Array?b:[];this.vertexTangents=[];this.materialIndex=c;this.centroid=new THREE.Vector3};THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var b=new THREE.Face4(this.a,this.b,this.c,this.d);b.normal.copy(this.normal);b.color.copy(this.color);b.centroid.copy(this.centroid);b.materialIndex=this.materialIndex;var a,c;for(a=0,c=this.vertexNormals.length;a<c;a++)b.vertexNormals[a]=this.vertexNormals[a].clone();for(a=0,c=this.vertexColors.length;a<c;a++)b.vertexColors[a]=this.vertexColors[a].clone();for(a=0,c=this.vertexTangents.length;a<c;a++)b.vertexTangents[a]=this.vertexTangents[a].clone();return b}};THREE.UV=function(a,b){this.u=a||0;this.v=b||0};THREE.UV.prototype={constructor:THREE.UV,"set":function(a,b){this.u=a;this.v=b;return this},copy:function(a){this.u=a.u;this.v=a.v;return this},lerpSelf:function(b,a){this.u+=(b.u-this.u)*a;this.v+=(b.v-this.v)*a;return this},clone:function(){return new THREE.UV(this.u,this.v)}};THREE.Geometry=function(){this.id=THREE.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=false};THREE.Geometry.prototype={constructor:THREE.Geometry,computeCentroids:function(){var b,c,a;for(b=0,c=this.faces.length;b<c;b++){a=this.faces[b];a.centroid.set(0,0,0);if(a instanceof THREE.Face3){a.centroid.addSelf(this.vertices[a.a]);a.centroid.addSelf(this.vertices[a.b]);a.centroid.addSelf(this.vertices[a.c]);a.centroid.divideScalar(3)}else if(a instanceof THREE.Face4){a.centroid.addSelf(this.vertices[a.a]);a.centroid.addSelf(this.vertices[a.b]);a.centroid.addSelf(this.vertices[a.c]);a.centroid.addSelf(this.vertices[a.d]);a.centroid.divideScalar(4)}}},computeBoundingSphere:function(){if(!this.boundingSphere)this.boundingSphere={radius:0};for(var b,a=0,c=0,d=this.vertices.length;c<d;c++){b=this.vertices[c].length();if(b>a)a=b}this.boundingSphere.radius=a},mergeVertices:function(){var k={},f=[],c=[],j,g,o=4,l=Math.pow(10,o),b,h,a,p="abcd",e,d,i,n,m;for(b=0,h=this.vertices.length;b<h;b++){j=this.vertices[b];g=[Math.round(j.x*l),Math.round(j.y*l),Math.round(j.z*l)].join("_");if(k[g]===undefined){k[g]=b;f.push(this.vertices[b]);c[b]=f.length-1}else c[b]=c[k[g]]}for(b=0,h=this.faces.length;b<h;b++){a=this.faces[b];if(a instanceof THREE.Face3){a.a=c[a.a];a.b=c[a.b];a.c=c[a.c]}else if(a instanceof THREE.Face4){a.a=c[a.a];a.b=c[a.b];a.c=c[a.c];a.d=c[a.d];e=[a.a,a.b,a.c,a.d];for(d=3;d>0;d--)if(e.indexOf(a[p[d]])!=d){e.splice(d,1);this.faces[b]=new THREE.Face3(e[0],e[1],e[2]);for(i=0,n=this.faceVertexUvs.length;i<n;i++){m=this.faceVertexUvs[i][b];m&&m.splice(d,1)}break}}}var q=this.vertices.length-f.length;this.vertices=f;return q}};THREE.GeometryCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4;this.projectionMatrixInverse=new THREE.Matrix4};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.lookAt=function(a){this.matrix.lookAt(this.position,a,this.up);this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)};THREE.PerspectiveCamera=function(d,a,b,c){THREE.Camera.call(this);this.fov=d!==undefined?d:50;this.aspect=a!==undefined?a:1;this.near=b!==undefined?b:.1;this.far=c!==undefined?c:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=new THREE.Camera;THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(b,a){a=a!==undefined?a:24;this.fov=2*Math.atan(a/(b*2))*(180/Math.PI);this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(b,a,e,f,d,c){this.fullWidth=b;this.fullHeight=a;this.x=e;this.y=f;this.width=d;this.height=c;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var c=this.fullWidth/this.fullHeight,a=Math.tan(this.fov*Math.PI/360)*this.near,d=-a,b=c*d,g=c*a,f=Math.abs(g-b),e=Math.abs(a-d);this.projectionMatrix.makeFrustum(b+this.x*f/this.fullWidth,b+(this.x+this.width)*f/this.fullWidth,a-(this.y+this.height)*e/this.fullHeight,a-this.y*e/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)};THREE.Light=function(a){THREE.Object3D.call(this);this.color=new THREE.Color(a)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(a){THREE.Light.call(this,a)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.PointLight=function(c,a,b){THREE.Light.call(this,c);this.position=new THREE.Vector3(0,0,0);this.intensity=a!==undefined?a:1;this.distance=b!==undefined?b:0};THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.Material=function(a){a=a||{};this.id=THREE.MaterialCount++;this.name="";this.opacity=a.opacity!==undefined?a.opacity:1;this.transparent=a.transparent!==undefined?a.transparent:false;this.blending=a.blending!==undefined?a.blending:THREE.NormalBlending;this.blendSrc=a.blendSrc!==undefined?a.blendSrc:THREE.SrcAlphaFactor;this.blendDst=a.blendDst!==undefined?a.blendDst:THREE.OneMinusSrcAlphaFactor;this.blendEquation=a.blendEquation!==undefined?a.blendEquation:THREE.AddEquation;this.depthTest=a.depthTest!==undefined?a.depthTest:true;this.depthWrite=a.depthWrite!==undefined?a.depthWrite:true;this.polygonOffset=a.polygonOffset!==undefined?a.polygonOffset:false;this.polygonOffsetFactor=a.polygonOffsetFactor!==undefined?a.polygonOffsetFactor:0;this.polygonOffsetUnits=a.polygonOffsetUnits!==undefined?a.polygonOffsetUnits:0;this.alphaTest=a.alphaTest!==undefined?a.alphaTest:0;this.overdraw=a.overdraw!==undefined?a.overdraw:false;this.visible=true;this.needsUpdate=true};THREE.MaterialCount=0;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.AdditiveAlphaBlending=5;THREE.CustomBlending=6;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MeshBasicMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:.98;this.fog=a.fog!==undefined?a.fog:true;this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:THREE.NoColors;this.skinning=a.skinning!==undefined?a.skinning:false;this.morphTargets=a.morphTargets!==undefined?a.morphTargets:false};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshLambertMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.color=a.color!==undefined?new THREE.Color(a.color):new THREE.Color(16777215);this.ambient=a.ambient!==undefined?new THREE.Color(a.ambient):new THREE.Color(16777215);this.emissive=a.emissive!==undefined?new THREE.Color(a.emissive):new THREE.Color(0);this.wrapAround=a.wrapAround!==undefined?a.wrapAround:false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=a.map!==undefined?a.map:null;this.lightMap=a.lightMap!==undefined?a.lightMap:null;this.envMap=a.envMap!==undefined?a.envMap:null;this.combine=a.combine!==undefined?a.combine:THREE.MultiplyOperation;this.reflectivity=a.reflectivity!==undefined?a.reflectivity:1;this.refractionRatio=a.refractionRatio!==undefined?a.refractionRatio:.98;this.fog=a.fog!==undefined?a.fog:true;this.shading=a.shading!==undefined?a.shading:THREE.SmoothShading;this.wireframe=a.wireframe!==undefined?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth!==undefined?a.wireframeLinewidth:1;this.wireframeLinecap=a.wireframeLinecap!==undefined?a.wireframeLinecap:"round";this.wireframeLinejoin=a.wireframeLinejoin!==undefined?a.wireframeLinejoin:"round";this.vertexColors=a.vertexColors!==undefined?a.vertexColors:THREE.NoColors;this.skinning=a.skinning!==undefined?a.skinning:false;this.morphTargets=a.morphTargets!==undefined?a.morphTargets:false;this.morphNormals=a.morphNormals!==undefined?a.morphNormals:false};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshNormalMaterial=function(a){THREE.Material.call(this,a);a=a||{};this.shading=a.shading?a.shading:THREE.FlatShading;this.wireframe=a.wireframe?a.wireframe:false;this.wireframeLinewidth=a.wireframeLinewidth?a.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};THREE.Texture=function(h,c,e,f,a,b,d,g){this.id=THREE.TextureCount++;this.image=h;this.mapping=c!==undefined?c:new THREE.UVMapping;this.wrapS=e!==undefined?e:THREE.ClampToEdgeWrapping;this.wrapT=f!==undefined?f:THREE.ClampToEdgeWrapping;this.magFilter=a!==undefined?a:THREE.LinearFilter;this.minFilter=b!==undefined?b:THREE.LinearMipMapLinearFilter;this.format=d!==undefined?d:THREE.RGBAFormat;this.type=g!==undefined?g:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.needsUpdate=false;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var a=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a}};THREE.TextureCount=0;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.DataTexture=function(i,f,e,d,j,c,g,h,a,b){THREE.Texture.call(this,null,c,g,h,a,b,d,j);this.image={data:i,width:f,height:e}};THREE.DataTexture.prototype=new THREE.Texture;THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.DataTexture.prototype.clone=function(){var a=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);a.offset.copy(this.offset);a.repeat.copy(this.repeat);return a};THREE.Mesh=function(b,c){THREE.Object3D.call(this);this.geometry=b;this.material=c!==undefined?c:new THREE.MeshBasicMaterial({color:Math.random()*16777215,wireframe:true});if(this.geometry){!this.geometry.boundingSphere&&this.geometry.computeBoundingSphere();this.boundRadius=b.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var a=0;a<this.geometry.morphTargets.length;a++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[a].name]=a}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Scene=function(){THREE.Object3D.call(this);this.fog=null;this.overrideMaterial=null;this.matrixAutoUpdate=false;this.__objects=[];this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.__addObject=function(a){if(a instanceof THREE.Light)this.__lights.indexOf(a)===-1&&this.__lights.push(a);else if(!(a instanceof THREE.Camera))if(this.__objects.indexOf(a)===-1){this.__objects.push(a);this.__objectsAdded.push(a);var c=this.__objectsRemoved.indexOf(a);c!==-1&&this.__objectsRemoved.splice(c,1)}for(var b=0;b<a.children.length;b++)this.__addObject(a.children[b])};THREE.Scene.prototype.__removeObject=function(a){if(a instanceof THREE.Light){var b=this.__lights.indexOf(a);b!==-1&&this.__lights.splice(b,1)}else if(!(a instanceof THREE.Camera)){var b=this.__objects.indexOf(a);if(b!==-1){this.__objects.splice(b,1);this.__objectsRemoved.push(a);var d=this.__objectsAdded.indexOf(a);d!==-1&&this.__objectsAdded.splice(d,1)}}for(var c=0;c<a.children.length;c++)this.__removeObject(a.children[c])};THREE.CanvasRenderer=function(I){I=I||{};var z=this,X,Y,w,wb=new THREE.Projector,K=I.canvas!==undefined?I.canvas:document.createElement("canvas"),V,T,f,e,a=K.getContext("2d"),D=new THREE.Color(0),C=0,L=1,ob=0,M=null,O=null,P=null,R=null,Q=null,d,b,h,v,fb=new THREE.RenderableVertex,gb=new THREE.RenderableVertex,p,q,r,s,t,u,A,B,bb,cb,db,eb,i=new THREE.Color,k=new THREE.Color,l=new THREE.Color,m=new THREE.Color,n=new THREE.Color,Z=[],W=[],xb,yb,ab,x,ib,jb,kb,lb,mb,nb,E=new THREE.Rectangle,g=new THREE.Rectangle,j=new THREE.Rectangle,S=false,o=new THREE.Color,pb=new THREE.Color,H=new THREE.Color,zb=Math.PI*2,c=new THREE.Vector3,J,F,hb,rb,G,N,y=16;J=document.createElement("canvas");J.width=J.height=2;F=J.getContext("2d");F.fillStyle="rgba(0,0,0,1)";F.fillRect(0,0,2,2);hb=F.getImageData(0,0,2,2);rb=hb.data;G=document.createElement("canvas");G.width=G.height=y;N=G.getContext("2d");N.translate(-y/2,-y/2);N.scale(y,y);y--;this.domElement=K;this.autoClear=true;this.sortObjects=true;this.sortElements=true;this.info={render:{vertices:0,faces:0}};this.setSize=function(b,a){V=b;T=a;f=Math.floor(V/2);e=Math.floor(T/2);K.width=V;K.height=T;E.set(-f,-e,f,e);g.set(-f,-e,f,e);L=1;ob=0;M=null;O=null;P=null;R=null;Q=null};this.setClearColor=function(b,a){D.copy(b);C=a!==undefined?a:1;g.set(-f,-e,f,e)};this.setClearColorHex=function(b,a){D.setHex(b);C=a!==undefined?a:1;g.set(-f,-e,f,e)};this.clear=function(){a.setTransform(1,0,0,-1,f,e);if(!g.isEmpty()){g.minSelf(E);g.inflate(2);C<1&&a.clearRect(Math.floor(g.getX()),Math.floor(g.getY()),Math.floor(g.getWidth()),Math.floor(g.getHeight()));if(C>0){setBlending(THREE.NormalBlending);vb(1);U("rgba("+Math.floor(D.r*255)+","+Math.floor(D.g*255)+","+Math.floor(D.b*255)+","+C+")");a.fillRect(Math.floor(g.getX()),Math.floor(g.getY()),Math.floor(g.getWidth()),Math.floor(g.getHeight()))}g.empty()}};this.render=function(J,P){var K,Q,y,C;this.autoClear?this.clear():a.setTransform(1,0,0,-1,f,e);z.info.render.vertices=0;z.info.render.faces=0;X=wb.projectScene(J,P,this.sortElements);Y=X.elements;w=X.lights;S=w.length>0;S&&R(w);for(K=0,Q=Y.length;K<Q;K++){y=Y[K];C=y.material;C=C instanceof THREE.MeshFaceMaterial?y.faceMaterial:C;if(C===undefined||C.visible===false)continue;j.empty();if(y instanceof THREE.RenderableLine){d=y.v1;b=y.v2;d.positionScreen.x*=f;d.positionScreen.y*=e;b.positionScreen.x*=f;b.positionScreen.y*=e;j.addPoint(d.positionScreen.x,d.positionScreen.y);j.addPoint(b.positionScreen.x,b.positionScreen.y);E.intersects(j)&&renderLine(d,b,y,C,J)}else if(y instanceof THREE.RenderableFace3){d=y.v1;b=y.v2;h=y.v3;d.positionScreen.x*=f;d.positionScreen.y*=e;b.positionScreen.x*=f;b.positionScreen.y*=e;h.positionScreen.x*=f;h.positionScreen.y*=e;if(C.overdraw){D(d.positionScreen,b.positionScreen);D(b.positionScreen,h.positionScreen);D(h.positionScreen,d.positionScreen)}j.add3Points(d.positionScreen.x,d.positionScreen.y,b.positionScreen.x,b.positionScreen.y,h.positionScreen.x,h.positionScreen.y);E.intersects(j)&&M(d,b,h,0,1,2,y,C,J)}else if(y instanceof THREE.RenderableFace4){d=y.v1;b=y.v2;h=y.v3;v=y.v4;d.positionScreen.x*=f;d.positionScreen.y*=e;b.positionScreen.x*=f;b.positionScreen.y*=e;h.positionScreen.x*=f;h.positionScreen.y*=e;v.positionScreen.x*=f;v.positionScreen.y*=e;fb.positionScreen.copy(b.positionScreen);gb.positionScreen.copy(v.positionScreen);if(C.overdraw){D(d.positionScreen,b.positionScreen);D(b.positionScreen,v.positionScreen);D(v.positionScreen,d.positionScreen);D(h.positionScreen,fb.positionScreen);D(h.positionScreen,gb.positionScreen)}j.addPoint(d.positionScreen.x,d.positionScreen.y);j.addPoint(b.positionScreen.x,b.positionScreen.y);j.addPoint(h.positionScreen.x,h.positionScreen.y);j.addPoint(v.positionScreen.x,v.positionScreen.y);E.intersects(j)&&T(d,b,h,v,fb,gb,y,C,J)}g.addRectangle(j)}a.setTransform(1,0,0,1,0,0);function R(d){var c,e,b,a;o.setRGB(0,0,0);pb.setRGB(0,0,0);H.setRGB(0,0,0);for(c=0,e=d.length;c<e;c++){b=d[c];a=b.color;if(b instanceof THREE.AmbientLight){o.r+=a.r;o.g+=a.g;o.b+=a.b}else if(b instanceof THREE.PointLight){H.r+=a.r;H.g+=a.g;H.b+=a.b}}}function F(i,h,k,g){var e,j,b,d,f,a;for(e=0,j=i.length;e<j;e++){b=i[e];d=b.color;if(b instanceof THREE.PointLight){f=b.matrixWorld.getPosition();a=k.dot(c.sub(f,h).normalize());if(a<=0)continue;a*=b.distance==0?1:1-Math.min(h.distanceTo(f)/b.distance,1);if(a==0)continue;a*=b.intensity;g.r+=d.r*a;g.g+=d.g*a;g.b+=d.b*a}}}function M(h,i,j,e,f,g,d,b){z.info.render.vertices+=3;z.info.render.faces++;p=h.positionScreen.x;q=h.positionScreen.y;r=i.positionScreen.x;s=i.positionScreen.y;t=j.positionScreen.x;u=j.positionScreen.y;L(p,q,r,s,t,u);if(b instanceof THREE.MeshBasicMaterial)if(b.map){if(b.map.mapping instanceof THREE.UVMapping){x=d.uvs[0];O(p,q,r,s,t,u,x[e].u,x[e].v,x[f].u,x[f].v,x[g].u,x[g].v,b.map)}}else if(b.envMap){if(b.envMap.mapping instanceof THREE.SphericalReflectionMapping){var a=P.matrixWorldInverse;c.copy(d.vertexNormalsWorld[e]);ib=(c.x*a.elements[0]+c.y*a.elements[4]+c.z*a.elements[8])*.5+.5;jb=-(c.x*a.elements[1]+c.y*a.elements[5]+c.z*a.elements[9])*.5+.5;c.copy(d.vertexNormalsWorld[f]);kb=(c.x*a.elements[0]+c.y*a.elements[4]+c.z*a.elements[8])*.5+.5;lb=-(c.x*a.elements[1]+c.y*a.elements[5]+c.z*a.elements[9])*.5+.5;c.copy(d.vertexNormalsWorld[g]);mb=(c.x*a.elements[0]+c.y*a.elements[4]+c.z*a.elements[8])*.5+.5;nb=-(c.x*a.elements[1]+c.y*a.elements[5]+c.z*a.elements[9])*.5+.5;O(p,q,r,s,t,u,ib,jb,kb,lb,mb,nb,b.envMap)}}else b.wireframe?I(b.color,b.wireframeLinewidth,b.wireframeLinecap,b.wireframeLinejoin):G(b.color)}function T(c,d,e,f,g,h,b,a,j){z.info.render.vertices+=4;z.info.render.faces++;if(a.map||a.envMap){M(c,d,f,0,1,3,b,a,j);M(g,e,h,1,2,3,b,a,j);return}p=c.positionScreen.x;q=c.positionScreen.y;r=d.positionScreen.x;s=d.positionScreen.y;t=e.positionScreen.x;u=e.positionScreen.y;A=f.positionScreen.x;B=f.positionScreen.y;bb=g.positionScreen.x;cb=g.positionScreen.y;db=h.positionScreen.x;eb=h.positionScreen.y;if(a instanceof THREE.MeshBasicMaterial){N(p,q,r,s,t,u,A,B);a.wireframe?I(a.color,a.wireframeLinewidth,a.wireframeLinecap,a.wireframeLinejoin):G(a.color)}else if(a instanceof THREE.MeshLambertMaterial)if(S)if(!a.wireframe&&a.shading==THREE.SmoothShading&&b.vertexNormalsWorld.length==4){k.r=l.r=m.r=n.r=o.r;k.g=l.g=m.g=n.g=o.g;k.b=l.b=m.b=n.b=o.b;F(w,b.v1.positionWorld,b.vertexNormalsWorld[0],k);F(w,b.v2.positionWorld,b.vertexNormalsWorld[1],l);F(w,b.v4.positionWorld,b.vertexNormalsWorld[3],m);F(w,b.v3.positionWorld,b.vertexNormalsWorld[2],n);k.r=Math.max(0,Math.min(a.color.r*k.r,1));k.g=Math.max(0,Math.min(a.color.g*k.g,1));k.b=Math.max(0,Math.min(a.color.b*k.b,1));l.r=Math.max(0,Math.min(a.color.r*l.r,1));l.g=Math.max(0,Math.min(a.color.g*l.g,1));l.b=Math.max(0,Math.min(a.color.b*l.b,1));m.r=Math.max(0,Math.min(a.color.r*m.r,1));m.g=Math.max(0,Math.min(a.color.g*m.g,1));m.b=Math.max(0,Math.min(a.color.b*m.b,1));n.r=Math.max(0,Math.min(a.color.r*n.r,1));n.g=Math.max(0,Math.min(a.color.g*n.g,1));n.b=Math.max(0,Math.min(a.color.b*n.b,1));ab=getGradientTexture(k,l,m,n);L(p,q,r,s,A,B);clipImage(p,q,r,s,A,B,0,0,1,0,0,1,ab);L(bb,cb,t,u,db,eb);clipImage(bb,cb,t,u,db,eb,1,0,1,1,0,1,ab)}else{i.r=o.r;i.g=o.g;i.b=o.b;F(w,b.centroidWorld,b.normalWorld,i);i.r=Math.max(0,Math.min(a.color.r*i.r,1));i.g=Math.max(0,Math.min(a.color.g*i.g,1));i.b=Math.max(0,Math.min(a.color.b*i.b,1));N(p,q,r,s,t,u,A,B);a.wireframe?I(i,a.wireframeLinewidth,a.wireframeLinecap,a.wireframeLinejoin):G(i)}else{N(p,q,r,s,t,u,A,B);a.wireframe?I(a.color,a.wireframeLinewidth,a.wireframeLinecap,a.wireframeLinejoin):G(a.color)}}function L(b,c,d,f,e,g){a.beginPath();a.moveTo(b,c);a.lineTo(d,f);a.lineTo(e,g);a.lineTo(b,c);a.closePath()}function N(b,c,d,g,e,h,f,i){a.beginPath();a.moveTo(b,c);a.lineTo(d,g);a.lineTo(e,h);a.lineTo(f,i);a.lineTo(b,c);a.closePath()}function I(e,b,d,c){sb(b);ub(d);tb(c);qb(e.getContextStyle());a.stroke();j.inflate(b*2)}function G(b){U(b.getContextStyle());a.fill()}function O(u,x,v,y,w,z,c,d,e,g,f,h,b){if(b.image.width==0)return;if(b.needsUpdate==true||Z[b.id]==undefined){var m=b.wrapS==THREE.RepeatWrapping,n=b.wrapT==THREE.RepeatWrapping;Z[b.id]=a.createPattern(b.image,m&&n?"repeat":m&&!n?"repeat-x":!m&&n?"repeat-y":"no-repeat");b.needsUpdate=false}U(Z[b.id]);var A,B,C,D,F,H,t,j,k=b.offset.x/b.repeat.x,l=b.offset.y/b.repeat.y,r=b.image.width*b.repeat.x,p=b.image.height*b.repeat.y;c=(c+k)*r;d=(d+l)*p;e=(e+k)*r;g=(g+l)*p;f=(f+k)*r;h=(h+l)*p;v-=u;y-=x;w-=u;z-=x;e-=c;g-=d;f-=c;h-=d;t=e*h-f*g;if(t==0){if(W[b.id]===undefined){var o=document.createElement("canvas");o.width=b.image.width;o.height=b.image.height;var E=o.getContext("2d");E.drawImage(b.image,0,0);W[b.id]=E.getImageData(0,0,b.image.width,b.image.height).data}var s=W[b.id],q=(Math.floor(c)+Math.floor(d)*b.image.width)*4;i.setRGB(s[q]/255,s[q+1]/255,s[q+2]/255);G(i);return}j=1/t;A=(h*v-g*w)*j;B=(h*y-g*z)*j;C=(e*w-f*v)*j;D=(e*z-f*y)*j;F=u-A*c-C*d;H=x-B*c-D*d;a.save();a.transform(A,B,C,D,F,H);if(THREE.removeGaps)a.drawImage(b.image,0,0);else a.fill();a.restore()}function D(c,d){if(THREE.removeGaps)return;var a=d.x-c.x,b=d.y-c.y,f=a*a+b*b,e;if(f==0)return;e=1/Math.sqrt(f)/2;a*=e;b*=e;d.x+=a;d.y+=b;c.x-=a;c.y-=b}};function vb(b){if(L!=b)a.globalAlpha=L=b}function sb(b){if(P!=b)a.lineWidth=P=b}function ub(b){if(R!=b)a.lineCap=R=b}function tb(b){if(Q!=b)a.lineJoin=Q=b}function qb(b){if(M!=b)a.strokeStyle=M=b}function U(b){if(O!=b)a.fillStyle=O=b}};THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=true};THREE.RenderableVertex.prototype.copy=function(a){this.positionWorld.copy(a.positionWorld);this.positionScreen.copy(a.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.material=null;this.faceMaterial=null;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.material=null;this.faceMaterial=null;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.object=null;this.z=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.material=null};THREE.CubeGeometry=function(d,b,c,u,t,i,e,g){THREE.Geometry.call(this);var f=this,l=d/2,j=b/2,k=c/2,p,q,r,m,n,o;if(e!==undefined){if(e instanceof Array)this.materials=e;else{this.materials=[];for(var s=0;s<6;s++)this.materials.push(e)}p=0;m=1;q=2;n=3;r=4;o=5}else this.materials=[];this.sides={px:true,nx:true,py:true,ny:true,pz:true,nz:true};if(g!=undefined)for(var h in g)if(this.sides[h]!==undefined)this.sides[h]=g[h];this.sides.px&&a("z","y",-1,-1,c,b,l,p);this.sides.nx&&a("z","y",1,-1,c,b,-l,m);this.sides.py&&a("x","z",1,1,d,c,j,q);this.sides.ny&&a("x","z",1,-1,d,c,-j,n);this.sides.pz&&a("x","y",1,-1,d,b,k,r);this.sides.nz&&a("x","y",-1,-1,d,b,-k,o);function a(e,g,z,A,q,o,p,x){var k,a,b,c=u||1,d=t||1,w=q/2,v=o/2,l=f.vertices.length;if(e==="x"&&g==="y"||e==="y"&&g==="x")k="z";else if(e==="x"&&g==="z"||e==="z"&&g==="x"){k="y";d=i||1}else if(e==="z"&&g==="y"||e==="y"&&g==="z"){k="x";c=i||1}var j=c+1,y=d+1,s=q/c,r=o/d,h=new THREE.Vector3;h[k]=p>0?1:-1;for(b=0;b<y;b++)for(a=0;a<j;a++){var m=new THREE.Vector3;m[e]=(a*s-w)*z;m[g]=(b*r-v)*A;m[k]=p;f.vertices.push(m)}for(b=0;b<d;b++)for(a=0;a<c;a++){var B=a+j*b,C=a+j*(b+1),D=a+1+j*(b+1),E=a+1+j*b,n=new THREE.Face4(B+l,C+l,D+l,E+l);n.normal.copy(h);n.vertexNormals.push(h.clone(),h.clone(),h.clone(),h.clone());n.materialIndex=x;f.faces.push(n);f.faceVertexUvs[0].push([new THREE.UV(a/c,b/d),new THREE.UV(a/c,(b+1)/d),new THREE.UV((a+1)/c,(b+1)/d),new THREE.UV((a+1)/c,b/d)])}}this.computeCentroids();this.mergeVertices()};THREE.CubeGeometry.prototype=new THREE.Geometry;THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry;Aroma.CanvasTools={};Aroma.CanvasTools.createBitmapSlice=function(a,d){var b=document.createElement("canvas");b.setAttribute("width",a.width);b.setAttribute("height",a.height);var c=b.getContext("2d");c.drawImage(d,a.x,a.y,a.width,a.height,0,0,a.width,a.height);return b};Aroma.CanvasTools.resizeImage=function(e,c,a){var b=document.createElement("canvas");b.setAttribute("width",Math.floor(a.width)+1);b.setAttribute("height",Math.floor(a.height)+1);var d=b.getContext("2d");d.drawImage(e,0,0,c.width,c.height,0,0,a.width,a.height);return b};Aroma.CanvasTools.flip=function(e,d,b,c){if(!b&&!c)return;var a=e.getContext("2d");a.save();a.translate(b?d.width:0,c?d.height:0);a.scale(b?-1:1,c?-1:1);a.drawImage(e,0,0);a.restore()};Aroma.ThreeView=function(b,a){Aroma.AbstractView.call(this,b,a);this.sort=true;this.needRendering=true;this.viewport=document.createElement("canvas");this.viewport_cx=this.viewport.getContext("2d");this.renderer=new THREE.CanvasRenderer({canvas:this.viewport});this.renderer.autoClear=false;THREE.removeGaps=b>3&&a>3};Aroma.ThreeView.prototype=new Aroma.AbstractView;Aroma.ThreeView.prototype.constructor=Aroma.ThreeView;Aroma.ThreeView.prototype.setup=function(){var c=1500,d=2*Math.atan(this.vpHeight/(2*c))*180/Math.PI;this.camera=new THREE.PerspectiveCamera(d,this.vpWidth/this.vpHeight,.1,1e4);this.camera.position.z=c;var a=new Image;a.src=this.oldSource.src;var b={width:a.width,height:a.height};a=null;this.oldSource=Aroma.CanvasTools.resizeImage(this.oldSource,b,{width:this.width,height:this.height});this.newSource=Aroma.CanvasTools.resizeImage(this.newSource,b,{width:this.width,height:this.height})};Aroma.ThreeView.prototype.setViewPortSize=function(b,a){Aroma.AbstractView.prototype.setViewPortSize.call(this,b,a);this.renderer.setSize(b,a)};Aroma.ThreeView.prototype.getPieceAt=function(c,d,f){var e=this.posToID(c,d);if(this._pieceList[e]!=null)return this._pieceList[e];var a=new Aroma.ThreeCubePiece,b=this.getPieceBounds(c,d);a.col=c;a.row=d;a.bounds=b;a.view=this;f.piece=a;ConcatObject.concat(a.options,f.getPieceOptions());a.setup(Aroma.CanvasTools.createBitmapSlice(b,this.newSource),Aroma.CanvasTools.createBitmapSlice(b,this.oldSource));this._pieceList[e]=a;return a};Aroma.ThreeView.prototype.dispose=function(){Aroma.AbstractView.prototype.dispose.call(this);this.renderer.clear()};Aroma.ThreeView.prototype.render=function(){this.renderer.clear();this.viewport_cx.clearRect(0,0,this.vpWidth,this.vpHeight);for(var a=0,b=this._pieceList.length;a<b;++a)this.renderer.render(this._pieceList[a].scene,this.camera)};Aroma.ThreeCubePiece=function(){Aroma.Piece.call(this);this.depth=0;this.options={flipX:false,flipY:false,fillSides:true,sideColor:3355443,newImageLocation:5,depth:800};this.side_dic={right:0,front:4,left:1,back:5,top:2,bottom:3}};Aroma.ThreeCubePiece.prototype=new Aroma.Piece;Aroma.ThreeCubePiece.prototype.constructor=Aroma.ThreeCubePiece;Aroma.ThreeCubePiece.prototype.setup=function(c,d,e){this.proxy={x:0,y:0,z:0,rotationX:0,rotationY:0,rotationZ:0,piece:this};this.newSource=c;this.oldSource=d;this.depth=e||this.options.depth;this.scene=new THREE.Scene;this.scene.add(this.view.camera);light1=new THREE.PointLight(16777215,.3,1.1e5);light1.position.z=500;light1.position.x=0;light1.position.y=0;light2=new THREE.AmbientLight(this.options.sideColor);this.scene.add(light2);this.scene.add(light1);var a=[];Aroma.CanvasTools.flip(this.newSource,this.bounds,this.options.flipX,this.options.flipY);for(var b=0;b<6;++b)if(b==4)a.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(d),overdraw:true}));else if(b==this.options.newImageLocation)a.push(new THREE.MeshBasicMaterial({map:new THREE.Texture(c),overdraw:true}));else a.push(new THREE.MeshLambertMaterial({shading:THREE.FlatShading,overdraw:true}));var f=new THREE.CubeGeometry(this.bounds.width,this.bounds.height,this.depth,1,1,1,a);this.cube=new THREE.Mesh(f,new THREE.MeshFaceMaterial);this.cube.position.x=this.origin_x=-this.view.width/2+this.bounds.x+this.bounds.width/2;this.cube.position.y=this.origin_y=this.view.height/2-this.bounds.y-this.bounds.height/2;this.cube.position.z=this.origin_z=-this.depth>>1;this.scene.add(this.cube)};Aroma.ThreeCubePiece.prototype.dispose=function(){this.scene.remove(this.cube);this.cube=null;this.scene=null;this.proxy=null};Aroma.ThreeCubePiece.prototype.proxyUpdate=function(){this.piece.cube.position.x=this.x+this.piece.origin_x;this.piece.cube.position.y=-this.y+this.piece.origin_y;this.piece.cube.position.z=this.z+this.piece.origin_z;this.piece.cube.rotation.x=this.rotationX*Math.PI/180;this.piece.cube.rotation.y=-this.rotationY*Math.PI/180;this.piece.cube.rotation.z=-this.rotationZ*Math.PI/180}